# P11 — DAST (OWASP ZAP baseline)

## C1 (★★) — Запуск сервиса в CI
- Workflow `.github/workflows/ci-p11-dast.yml` автоматически поднимает приложение FastAPI на раннере через `uvicorn app.main:app --host 0.0.0.0 --port 8000`.
- Сервис запускается в фоновом режиме, ожидание готовности через цикл проверки health-эндпоинта `/health` с таймаутом 30 секунд.
- Приложение доступно по `http://localhost:8000` для сканирования ZAP, используется реальная конфигурация с установленными зависимостями из `requirements.txt`.
- Health-чек выполняется через `curl -sf http://localhost:8000/health` до получения успешного ответа.

## C2 (★★) — Запуск ZAP baseline
- ZAP baseline запускается через Docker-образ `owasp/zap2docker-stable` с флагом `--network host` для доступа к localhost.
- Сканирование выполняется против целевого URL `http://localhost:8000` с генерацией HTML и JSON отчётов.
- Используется флаг `-d` для детального вывода и `|| true` для предотвращения падения job при обнаружении уязвимостей.
- Результаты сканирования воспроизводимы при повторном запуске на том же коммите, используется фиксированный образ ZAP.

## C3 (★★) — Артефакты в EVIDENCE/P11/
- В `EVIDENCE/P11/` сохраняются отчёты: `zap_baseline.html` (человекочитаемый) и `zap_baseline.json` (машиночитаемый).
- Все файлы загружаются как артефакт в Actions с именем `P11_EVIDENCE_{run_id}_{sha}`, retention 90 дней.
- Артефакты доступны через Actions → Artifacts, в PR описании есть ссылки на успешный job и результаты сканирования.
- Структура EVIDENCE/P11/ вписана в общий каталог EVIDENCE/ без дублирования старых отчётов.

## C4 (★★) — Интерпретация результатов
- В PR описании зафиксировано: целевой URL сканирования (`http://localhost:8000`), количество алертов по уровням (High/Medium/Low), план действий по найденным проблемам.
- Все реальные уязвимости проанализированы: либо исправлены (с ссылкой на коммит/PR), либо задокументированы как принятый риск с обоснованием.
- Ложноположительные срабатывания идентифицированы и задокументированы с объяснением, почему они не критичны для данного проекта.

## C5 (★★) — Интеграция в CI
- Workflow триггерится на `workflow_dispatch`, `push` по релевантным путям (`app/**`, `src/**`, workflow файл), использует `contents: read`, таймаут 30 минут.
- Concurrency настроен (`${{ github.workflow }}-${{ github.ref }}`, `cancel-in-progress: true`), не конфликтует с другими workflows (ci.yml, ci-sbom-sca.yml, ci-sast-secrets.yml).
- Все шаги выполняются с `if: always()` для сохранения артефактов даже при ошибках, обработка ошибок через `|| true` для предотвращения блокировки разработки.
- Workflow интегрирован в общую схему CI/CD, результаты DAST используются для улучшения безопасности приложения на этапе разработки.
